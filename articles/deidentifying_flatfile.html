<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Deidentifying a Flat File • DeIDmachinedata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deidentifying a Flat File">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DeIDmachinedata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/deidentifying_flatfile.html">Deidentifying a Flat File</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Deidentifying a Flat File</h1>
            
      

      <div class="d-none name"><code>deidentifying_flatfile.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Ophthalmology uses many devices to monitor and record a patient’s
visual function. After extracting historical information from a device,
the data must be de-identified before submitting to SOURCE, the Sight
OUtcomes Research CollaborativE (<a href="https://www.sourcecollaborative.org/" class="external-link uri">https://www.sourcecollaborative.org/</a>).</p>
<p>The two functions in the package <em>DeIDmachinedata</em> can be
used, along with crosswalks provided by IT, to complete the data
preparation. The functions <a href="#loadxwalks">loadxwalks()</a> and <a href="#filedeid">fileDeID()</a> are flexible enough to use with data
extracted from many devices. The examples is this vignette are for</p>
<ul>
<li>Pentacam</li>
<li>Visual Field tests extracted with FORUM</li>
<li>OCT scans from both CIRRUS and Spectrallis devices</li>
</ul>
<p>The deidentification process involves</p>
<ol style="list-style-type: decimal">
<li><p>replacing the patient’s actual MRN with a Tokenized MRN from
Datavant’s linkage environment;</p></li>
<li><p>shifting actual test dates by a patient-specific,
SOURCE-determined number of days; and</p></li>
<li>
<p>removing or blanking remaining PII information. Some examples of
information to remove:</p>
<ol style="list-style-type: lower-alpha">
<li>demographic information: date of birth, sex. These will already be
available in the SOURCE patient file. No need to include them here</li>
<li>file information: some extractions indicate the location of the
image data in a local file system. This is no use to SOURCE and could
potentially reidentify the person.</li>
<li>service information: some extractions include the location of the
test/scan. Not technically PII, but SOURCE masks site information so we
would eliminate this column on our end if you didn’t.</li>
</ol>
</li>
</ol>
<div class="section level3">
<h3 id="before-you-start">Before you start<a class="anchor" aria-label="anchor" href="#before-you-start"></a>
</h3>
<p>Get two files from your IT. These files are the crosswalk between the
MRN and Tokenized MRN and the date-shift repository. These files are
created as part of the extraction from EPIC using code shared by the
SOURCE Data Architect Team.</p>
<p>Inspect the files you want to deidentify. You’ll need to
determine</p>
<ol style="list-style-type: lower-alpha">
<li>the names of the variables that contain PII. The functions described
here pass-through any columns not mentioned in the arguments from the
input file to the output file.</li>
<li>the format of any date or datetime variables to be shifted.</li>
</ol>
<p>Install the R package “DeIDmachinedata” from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"chrisandrewsphd/DeIDmachinedata"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="after-you-finish">After you finish<a class="anchor" aria-label="anchor" href="#after-you-finish"></a>
</h3>
<p>Of course, inspect the output files to confirm that you have properly
used the functions so that PII is no longer present. Then deliver the
files to SOURCE as you have delivered other files.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-deidmachinedata">Using DeIDmachinedata<a class="anchor" aria-label="anchor" href="#using-deidmachinedata"></a>
</h2>
<p>Within R, load the R library:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chrisandrewsphd.github.io/DeIDmachinedata/">DeIDmachinedata</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="loadxwalks">loadxwalks()<a class="anchor" aria-label="anchor" href="#loadxwalks"></a>
</h3>
<p>loadxwalks() reads the two files provided by IT and creates a
data.frame in R. The input files can be in various formats, but the
resulting data.frame has the structure expected by <a href="#filedeid">fileDeID()</a>. This function call is used regardless
of the type of machine data to be deidentified.</p>
<p>A typical call creates the data.frame “xwalk” in your
environment:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xwalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadxwalks.html">loadxwalks</a></span><span class="op">(</span></span>
<span>  tokenfile <span class="op">=</span> <span class="st">"mrncrosswalk.csv"</span>,</span>
<span>  dateshiftfile <span class="op">=</span> <span class="st">"mrndateshift.csv"</span><span class="op">)</span></span></code></pre></div>
<p>You’ll need to specify the proper filenames. Supply the complete path
if they are not in the R working directory.</p>
<p>If you are interested in this object, you can run a few lines of R
code</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># OPTIONAL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># list objects in the environment; will include "xwalk"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xwalk</span><span class="op">)</span> <span class="co"># display the first 6 lines of xwalk</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filedeid">fileDeID()<a class="anchor" aria-label="anchor" href="#filedeid"></a>
</h3>
<p><a href="#filedeid">fileDeID()</a> uses the crosswalk created by <a href="#loadxwalks">loadxwalks()</a> to perform the 3 items listed above
on a specified file. Specifically, the patient ID is replace by a
tokenized version, dates and datetimes are shifted, and other specified
columns are removed.</p>
<div class="section level4">
<h4 id="pentacam">Pentacam<a class="anchor" aria-label="anchor" href="#pentacam"></a>
</h4>
<p>In our experience with Pentacam,</p>
<ol style="list-style-type: decimal">
<li>the variable containing the patient’s MRN is “PAT-ID:”;</li>
<li>the variable to be dateshifted is “Exam Date:” (with format
“%Y%m%d”: 4-digit year, 2-digit month, and 2-digit day with no
separators); and</li>
<li>the variables to be removed are “Last Name:”, “First Name:”,
“D.o.Birth:”, and “Exam Comment:”.</li>
</ol>
<p>Thus, the standard call is</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fileDeID.html">fileDeID</a></span><span class="op">(</span></span>
<span>  filetodeid <span class="op">=</span> <span class="st">"pentacam.csv"</span>,</span>
<span>  fd_varname_mrn <span class="op">=</span> <span class="st">"PAT-ID:"</span>,</span>
<span>  variablestoremove <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Last Name:"</span>, <span class="st">"First Name:"</span>, <span class="st">"D.o.Birth:"</span>, <span class="st">"Exam Comment:"</span><span class="op">)</span>,</span>
<span>  datevariablestodateshift <span class="op">=</span> <span class="st">"Exam Date:"</span>,</span>
<span>  dateformat <span class="op">=</span> <span class="st">"%Y%m%d"</span>,</span>
<span>  xwalk <span class="op">=</span> <span class="va">xwalk</span>,</span>
<span>  outputfile <span class="op">=</span> <span class="st">"SOURCE_"</span><span class="op">)</span></span></code></pre></div>
<p>It reads the file “pentacam.csv” and writes the file
“SOURCE_pentacam.csv”</p>
<p>A second Pentacam example where the variables are separated by
semicolons and the datetime format is ISO 8601 (<a href="https://en.wikipedia.org/wiki/ISO_8601" class="external-link uri">https://en.wikipedia.org/wiki/ISO_8601</a>)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fileDeID.html">fileDeID</a></span><span class="op">(</span></span>
<span>  filetodeid <span class="op">=</span> <span class="st">"./Data/Example.csv"</span>,</span>
<span>  fd_varname_mrn <span class="op">=</span> <span class="st">"Patient ID"</span>,</span>
<span>  variablestoremove <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"First name"</span>, <span class="st">"Last name"</span>, <span class="st">"National ID"</span>, <span class="st">"OD Comment"</span>, <span class="st">"OS Comment"</span><span class="op">)</span>,</span>
<span>  datetimevariablestodateshift <span class="op">=</span> <span class="st">"Date / Time"</span>,</span>
<span>  datetimeformat <span class="op">=</span> <span class="st">"%Y-%m-%dT%H:%M:%OS"</span>,</span>
<span>  separator <span class="op">=</span> <span class="st">";"</span>,</span>
<span>  xwalk <span class="op">=</span> <span class="va">xwalk</span>,</span>
<span>  outputfile <span class="op">=</span> <span class="st">"./Data/Example_out.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visual-field-via-forum">Visual Field (via FORUM)<a class="anchor" aria-label="anchor" href="#visual-field-via-forum"></a>
</h4>
<p>The extraction process for visual fields often produces several flat
files corresponding to the several test formats (24-2, 10-2, etc.).
These can each be deidentified separately. Other than the input and
output filenames, the calls to fileDeID() are identical.</p>
<ol style="list-style-type: decimal">
<li>the variable containing the patient’s MRN is usually “MRN” (but
sometimes “MRN0”);</li>
<li>the variable to be dateshifted is “TestDate” (with format “%Y%m%d”:
4-digit year, 2-digit month, and 2-digit day with no separators) or
“TestDateTime” (with format “%Y-%m-%d %H:%M:%OS”: 4-digit year, hypen,
2-digit month, hypen, 2-digit day, space, 2-digit hour (00-23), colon,
2-digit minute, colon, 2-digit second) or both; and</li>
<li>the variables to be removed are “TestID”, “Name”, “MRN0” (or “MRN”),
“DOB”, “Age”, “Sex”, and “Institution”.</li>
</ol>
<p>Thus, the typical call is</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fileDeID.html">fileDeID</a></span><span class="op">(</span></span>
<span>    filetodeid <span class="op">=</span> <span class="st">"OPH_HVF.csv"</span>,</span>
<span>    fd_varname_mrn <span class="op">=</span> <span class="st">"MRN"</span>,</span>
<span>    variablestoremove <span class="op">=</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TestID"</span>, <span class="st">"Name"</span>, <span class="st">"MRN0"</span>, <span class="st">"DOB"</span>, <span class="st">"Age"</span>, <span class="st">"Sex"</span>, <span class="st">"Institution"</span><span class="op">)</span>,</span>
<span>    datevariablestodateshift <span class="op">=</span> <span class="st">"TestDate"</span>,</span>
<span>    dateformat <span class="op">=</span> <span class="st">"%Y%m%d"</span>,</span>
<span>    datetimevariablestodateshift <span class="op">=</span> <span class="st">"TestDateTime"</span>,</span>
<span>    datetimeformat <span class="op">=</span> <span class="st">"%Y-%m-%d %H:%M:%OS"</span>,</span>
<span>    xwalk <span class="op">=</span> <span class="va">xwalk</span>,</span>
<span>    outputfile <span class="op">=</span> <span class="st">"SOURCE_"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cirrus-oct">CIRRUS OCT<a class="anchor" aria-label="anchor" href="#cirrus-oct"></a>
</h4>
<p>Our experience with CIRRUS OCT is limited to one instance. In that
case,</p>
<ol style="list-style-type: decimal">
<li>the variable containing the patient’s MRN is “PatientID”;</li>
<li>the variable to be dateshifted is “StudyIDNUM” (with format
“%Y%m%d”: 4-digit year, 2-digit month, and 2-digit day with no
separators); and</li>
<li>the variables to be removed are filename paths:
“DicomFilePath_ODCube”, “DicomFilePath_GlaucOUAnalysis”, and
“DicomFilePath_CorrespondingPDF”.</li>
</ol>
<p>Thus, the function call is</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fileDeID.html">fileDeID</a></span><span class="op">(</span></span>
<span>  filetodeid <span class="op">=</span> <span class="st">"cirrus_oct_rnfl.csv"</span>,</span>
<span>  fd_varname_mrn <span class="op">=</span> <span class="st">"PatientID"</span>,</span>
<span>  variablestoremove <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"DicomFilePath_ODCube"</span>,</span>
<span>    <span class="st">"DicomFilePath_GlaucOUAnalysis"</span>,</span>
<span>    <span class="st">"DicomFilePath_CorrespondingPDF"</span><span class="op">)</span>,</span>
<span>  datevariablestodateshift <span class="op">=</span> <span class="st">"StudyIDNUM"</span>,</span>
<span>  dateformat <span class="op">=</span> <span class="st">"%Y%m%d"</span>,</span>
<span>  xwalk <span class="op">=</span> <span class="va">xwalk</span>,</span>
<span>  outputfile <span class="op">=</span> <span class="st">"SOURCE_OCT_RNFL.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="oct-spectralis">OCT Spectralis<a class="anchor" aria-label="anchor" href="#oct-spectralis"></a>
</h4>
<ol style="list-style-type: decimal">
<li>the variable containing the patient’s MRN is “Patient.ID”; and</li>
<li>the variable to be dateshifted is “OCT.Scan.Date”.</li>
</ol>
</div>
<div class="section level4">
<h4 id="hfa-via-elze-software">HFA via Elze Software<a class="anchor" aria-label="anchor" href="#hfa-via-elze-software"></a>
</h4>
<ol style="list-style-type: decimal">
<li>the variable containing the patient’s MRN is “id”; and</li>
<li>the variable to be dateshifted is “examtesttime” (with format
“%y%m%d%H%M”: 2-digit year, 2-digit month, 2-digit day; 2-digit hour;
and 2-digit minute with no separators)</li>
<li>several variables to remove including date of birth, sex, a second
exam time variable that looks like an internal SAS-type representation
of the datetime, institution, and two file paths.</li>
</ol>
</div>
</div>
</div>
<div class="section level2">
<h2 id="random-package-details">Random Package Details<a class="anchor" aria-label="anchor" href="#random-package-details"></a>
</h2>
<p>Both functions have help pages. Use ?loadxwalks and ?fileDeID to see
the complete list of arguments.</p>
<div class="section level3">
<h3 id="date-formats">Date Formats<a class="anchor" aria-label="anchor" href="#date-formats"></a>
</h3>
<p>If dates or datetimes are not stored in the common formats given in
the examples here, use <code><a href="https://rdrr.io/r/base/strptime.html" class="external-link">?strptime</a></code> to create the proper
format for your data.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chris Andrews.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
